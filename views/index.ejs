  <!DOCTYPE html>
  <html>
    <head>
      <title>1$ Cards Against Humanity</title>
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>
    <style>
      .card-section{
        width: 100%;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content:flex-start;
        align-items: stretch;
        align-content: flex-start;
        min-height: 50vh;
      }
      .card{
        border-radius: 0.5em;
        margin:0.3em;
        padding: 0.5em;
        width: 8vw;
        min-width: 10ch;
        box-shadow: 0.25em 0.25em 1em 0em #00000094;
        transition: box-shadow ease 0.5s;
        word-wrap: break-word;
      }
      span.blank{
        border-bottom: 1px solid black;
      }
      .black span.blank{
        display: inline-block;
        min-width: 5ch;
        max-width: 8ch;
        width: 50%;
        border-color: white;
      }

      .card:hover{
        box-shadow:0.5em 0.5em 1.3em 0em #00000094;
      }
      .black{
        align-self: flex-start;
        color: white;
        background-color: black;
      }
      .white{
        align-self: 
      }
      .comb:not(.hidden){
        cursor: pointer;
      }
      .comb.hidden{
        filter: blur(3px);
      }
      .card.selected{
        border:2px solid black;
         box-shadow: box-shadow: 0em 0em 0em 0em #00000094;
      }
      .card.white:not(.selected),.card.comb:not(.selected):not(.hidden){
        cursor: pointer;
       
      }
      .card.selected:hover{
        box-shadow: box-shadow: 0em 0em 0em 0em #00000094;
      }
    </style>
    <body>

        <div id="top" class="card-section">

        </div>
        <div id="message" style="width: 100%;text-align: center;">
          
        </div>
        <div id="bottom" class="card-section">

        </div>
        <div id="score">
          <table>
            <caption>scores</caption>
            <tbody>
            </tbody>
          </table>
        </div>
      <!--JavaScript at end of body for optimized loading-->
      <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
              <script>
                var name = "<%- name %>";
          let socket = new WebSocket("ws://localhost:80/");

        socket.onopen = function(e) {
          var resp = {
                  update:true,
                  name:name}
          socket.send(JSON.stringify(resp));
          //socket.send("My name is John");
        };
        
        var cardsneeded = 0;
        socket.onmessage = function(event) {
          console.log("recived");
          console.log(event);
          var data = JSON.parse(event.data);
          if(data.update){
            var resp = {update:true,name:name};
            socket.send(JSON.stringify(resp));
          }else{
            //add cards 
            if(data.white){
              $("#bottom").empty()
                    data.white.forEach(function(card){
              card = $("<div></div>").text(card.text).addClass("card").addClass("white").prop("card-id",card.id);
              $("#bottom").append(card);
                });
            }
      

            if(data.black){
              $(".black").remove();
              data.black.forEach(function(card){
                cardsneeded = card.spaces;
              card = $("<div></div>").text(card.text).addClass("card").addClass("black").prop("card-id",card.id);
                $("#top").append(card);
              });
            }
            if(data.comb){
              $(".comb").remove();
              data.comb.forEach(function(card){
              card = $("<div></div>").html(card.text).addClass("card").addClass("hidden").addClass("comb").prop("card-name",card.name);
              $("#top").append(card);
            });
            }
            $("#score tbody").empty();
            data.score.forEach(function(score){
              scorename = $("<td></td>").text(score.name);
              score = $("<td></td>").text(score.score);
              row= $("<tr></tr>").append(scorename).append(score);
              $("#score tbody").append(row);
            })

              if(data.game==0){
                $("#message").text("please wait for the game to start");
              }else if(data.game== 1){
                $("#message").text("");
                if(data.pick){

                  $("#message").text("it is your turn to pick who wins");
                }else{
                      $(".white").click((e)=>{
                        if(cardsneeded>0){
                          $(e.target).addClass("selected");
                          cardsneeded-=1;
                          if(cardsneeded==0){
                            ids = $(".selected").map(function(){return $(this).prop("card-id")}).get();
                            var resp = {
                              update:false,
                              name:name,
                              white:ids
                            };
                            socket.send(JSON.stringify(resp));
                          }
                        }
                   });
                }
              }else if(data.game== 2){
                  $("#message").text("");
                  $(".comb").removeClass("hidden");
                  if(!data.pick){

                  $("#message").text("please wait while the winner is picked");
          
                }else{
                  $(".comb").click((e)=>{
                    $(e.target).prop("card-name");
                     var resp = {
                              update:false,
                              name:name,
                              comb:;
                            };
                      socket.send(JSON.stringify(resp));
                  });
                }
              }
          



          }
        };

        socket.onclose = function(event) {

        };

        socket.onerror = function(error) {

        };
        </script>
    </body>
  </html>
