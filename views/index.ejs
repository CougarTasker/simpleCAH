  <!DOCTYPE html>
  <html>
    <head>
      <title>1$ Cards Against Humanity</title>
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>
    <style>
      body{
                -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
                                  font-family: 'Roboto', sans-serif;
      }
      table,th,td {
    border: none
}

table {
    width: 75%;
    margin:0 auto;
    display: table;
    border-collapse: collapse;
    border-spacing: 0
}

table.striped tr {
    border-bottom: none
}

table.striped>tbody>tr:nth-child(odd) {
    background-color: rgba(242,242,242,0.5)
}

table.striped>tbody>tr>td {
    border-radius: 0
}

table.highlight>tbody>tr {
    -webkit-transition: background-color .25s ease;
    transition: background-color .25s ease
}

table.highlight>tbody>tr:hover {
    background-color: rgba(242,242,242,0.5)
}

table.centered thead tr th,table.centered tbody tr td {
    text-align: center
}

tr {
    border-bottom: 1px solid rgba(0,0,0,0.12)
}

td,th {
    padding: 15px 5px;
    display: table-cell;
    text-align: left;
    vertical-align: middle;
    border-radius: 2px
}
      .card-section{
        width: 100%;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content:flex-start;
        align-items: stretch;
        align-content: flex-start;
        min-height: 50vh;
      }
      .card{
        border-radius: 0.5em;
        margin:0.3em;
        padding: 0.5em;
        width: 10vw;
        min-height: 20vh;
        box-sizing: border-box;
        min-width: 15ch;
        box-shadow: 0.25em 0.25em 1em 0em #00000094;
        transition: box-shadow ease 0.5s, color ease 0.5s;
      }
      span.blank{
        text-decoration:underline;
      }
      .black span.blank{
        display: inline-block;
        min-width: 5ch;
        max-width: 8ch;
        width: 50%;
        border-color: white;
      }

      .card:not(.selected):not(.grey):not(.hidden):hover{
        box-shadow:0.5em 0.5em 1.3em 0em #00000094;
      }
      .black{
        align-self: flex-start;
        color: white;
        background-color: black;
      }
      .white{

      }
      .comb{
         transition: box-shadow ease 0.5s, filter ease 2s;
      }
      .comb.hidden{
        filter: blur(4px);
      }
      .card.selected{
        border:2px solid black;
         box-shadow: 0em 0em 0em 0em #00000094;
      }
      .grey{
        color: white;
        background-color: grey;
        box-shadow: 0em 0em 0em 0em #00000094;
      }
      .card.white:not(.selected):not(.grey),.card.comb:not(.selected):not(.hidden):not(.grey){
        cursor: pointer;
       
      }
      .card.selected:hover{
        box-shadow: box-shadow: 0em 0em 0em 0em #00000094;
      }
    </style>
    <body>

        <div id="top" class="card-section">

        </div>
        <div id="message" style="width: 100%;text-align: center;">
          
        </div>
        <div id="bottom" class="card-section">

        </div>
        <div id="score">
          <table class="striped">
            <thead>
              <tr><td>Name</td><td>Score</td></tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      <!--JavaScript at end of body for optimized loading-->
      <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
              <script>
                var name = "<%- name %>";
          let socket = new WebSocket("ws://localhost:80/");

        socket.onopen = function(e) {
          var resp = {
                  update:true,
                  name:name}
          socket.send(JSON.stringify(resp));
          //socket.send("My name is John");
        };
        
        var cardsneeded = 0;
        socket.onmessage = function(event) {
          var data = JSON.parse(event.data);
          if(data.update){
            var resp = {update:true,name:name};
            socket.send(JSON.stringify(resp));
          }else{
            //add cards 
            if(data.white){
              $("#bottom").empty()
                    data.white.forEach(function(card){
              card = $("<div></div>").text(card.text).addClass("card").addClass("white").addClass("grey").prop("card-id",card.id);
              $("#bottom").append(card);
                });
            }
      

            if(data.black){
              $(".black").remove();
              data.black.forEach(function(card){
                cardsneeded = card.spaces;
              card = $("<div></div>").text(card.text).addClass("card").addClass("black").prop("card-id",card.id);
                $("#top").append(card);
              });
            }
            if(data.comb){
              $(".comb").remove();
              data.comb.forEach(function(card){
                card = $("<div></div>").html(card.text).addClass("card").addClass("hidden").addClass("grey").addClass("comb").prop("card-name",card.name);
                $("#top").append(card);
              });
            }


            $("#score tbody").empty();
            data.score.forEach(function(score){
              scorename = $("<td></td>").text(score.name);
              score = $("<td></td>").text(score.score);
              row= $("<tr></tr>").append(scorename).append(score);
              $("#score tbody").append(row);
            });

            if(data.game==0){
              $("#message").text("please wait for the game to start");
            }else if(data.game== 1){
              if(cardsneeded==1){
                $("#message").text("please select the card that fits the gap");
              }else{
                $("#message").text("please select the cards that fit the gaps");
              }
              $(".white").removeClass("grey");
              $(".white").click((e)=>{
                if(cardsneeded>0){
                  $(e.currentTarget).addClass("selected");
                  cardsneeded-=1;
                  if(cardsneeded==0){
                    ids = $(".selected").map(function(){return $(this).prop("card-id")}).get();
                    var resp = {
                      update:false,
                      name:name,
                      white:ids
                    };
                    socket.send(JSON.stringify(resp));
                  }
                }
              });
            }else if(data.game== 2){
              $("#message").text("please wait for all the players to select their cards");
            }else if(data.game== 3){
              $(".comb").removeClass("hidden");
              $("#message").text("please wait while the winner is picked");
            }else if(data.game== 4){
              $(".comb").removeClass("hidden").removeClass("grey");
              $("#message").text("please select the winner");
              $(".comb").click((e)=>{
                winner = $(e.currentTarget).prop("card-name");
                console.log(winner);
                 var resp = {
                          update:false,
                          name:name,
                          comb:winner
                        };
                  console.log(resp);
                  socket.send(JSON.stringify(resp));
              });
            }
          }
        };

        socket.onclose = function(event) {

        };

        socket.onerror = function(error) {

        };
        </script>
    </body>
  </html>
